<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate - PhishGuard.uz</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .lang-switch {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            padding: 6px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .lang-btn {
            padding: 8px 16px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .lang-btn.active {
            background: white;
            color: #2563eb;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .lang-btn:hover:not(.active) {
            background: rgba(255,255,255,0.15);
        }

        .certificate-container {
            background: white;
            max-width: 900px;
            width: 100%;
            padding: 60px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 12px solid #eab308;
            position: relative;
        }

        .certificate-container::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            border: 3px solid #fbbf24;
            border-radius: 8px;
            pointer-events: none;
        }

        .cert-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .cert-badge {
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #eab308, #fbbf24);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            box-shadow: 0 8px 20px rgba(234,179,8,0.4);
        }

        .cert-title {
            font-family: 'Playfair Display', serif;
            font-size: 48px;
            font-weight: 900;
            color: #78350f;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .cert-subtitle {
            font-size: 18px;
            color: #64748b;
            font-weight: 500;
        }

        .cert-body {
            text-align: center;
            margin: 40px 0;
        }

        .cert-text {
            font-size: 16px;
            color: #64748b;
            margin-bottom: 20px;
        }

        .cert-name {
            font-family: 'Playfair Display', serif;
            font-size: 42px;
            font-weight: 700;
            color: #1e293b;
            margin: 30px 0;
            padding: 20px;
            border-bottom: 3px solid #eab308;
            display: inline-block;
        }

        .cert-achievement {
            font-size: 18px;
            color: #1e293b;
            margin: 30px 0;
            line-height: 1.8;
        }

        .cert-footer {
            margin-top: 50px;
            display: flex;
            justify-content: space-around;
            padding-top: 30px;
            border-top: 2px solid #e2e8f0;
        }

        .cert-signature {
            text-align: center;
        }

        .signature-line {
            width: 200px;
            height: 2px;
            background: #94a3b8;
            margin: 0 auto 10px;
        }

        .signature-title {
            font-weight: 600;
            color: #1e293b;
            font-size: 14px;
        }

        .signature-name {
            color: #64748b;
            font-size: 12px;
            margin-top: 5px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
            font-family: 'Montserrat', sans-serif;
            font-size: 15px;
            border: none;
            cursor: pointer;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #1e293b;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .btn-download {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-download:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        @media print {
            body { background: white; }
            .action-buttons { display: none; }
            .lang-switch { display: none; }
        }
    </style>
</head>
<body>

    <!-- Language Switch -->
    <div class="lang-switch">
        <a href="{{ url_for('set_lang', lang='en') }}" class="lang-btn {% if lang == 'en' %}active{% endif %}">English</a>
        <a href="{{ url_for('set_lang', lang='uz') }}" class="lang-btn {% if lang == 'uz' %}active{% endif %}">O'zbek</a>
    </div>

    <div class="certificate-container" id="certificate">
        <div class="cert-header">
            <div class="cert-badge">üéì</div>
            <h1 class="cert-title" data-translate="cert-title">Certificate</h1>
            <p class="cert-subtitle" data-translate="cert-subtitle">of Completion</p>
        </div>

        <div class="cert-body">
            <p class="cert-text" data-translate="cert-text-intro">This is to certify that</p>
            <div class="cert-name">{{ full_name }}</div>
            
            <div class="cert-achievement">
                <span data-translate="cert-achievement-line1">Has successfully completed the</span>
                <br>
                <strong data-translate="cert-program-name">PhishGuard Phishing Awareness Training Program</strong>
                <br>
                <span data-translate="cert-achievement-line2">and demonstrated proficiency in identifying and preventing phishing attacks</span>
                <br>
                <strong><span data-translate="cert-score-label">Final Exam Score:</span> {{ score }}%</strong>
            </div>
        </div>

        <div class="cert-footer">
            <div class="cert-signature">
                <div class="signature-line"></div>
                <div class="signature-title" data-translate="cert-sig-title">Program Director</div>
                <div class="signature-name" data-translate="cert-sig-org">PhishGuard.uz</div>
            </div>
            <div class="cert-signature">
                <div class="signature-line"></div>
                <div class="signature-title" data-translate="cert-sig-date-label">Date of Completion</div>
                <div class="signature-name">{{ date }}</div>
            </div>
        </div>
    </div>

    <div class="action-buttons">
        <a href="{{ url_for('home') }}" class="btn btn-secondary" data-translate="btn-back">‚Üê Back to Home</a>
        <button type="button" onclick="downloadCertificate()" class="btn btn-download" data-translate="btn-download">üìÑ Download Certificate</button>
        <button type="button" onclick="window.print()" class="btn btn-primary" data-translate="btn-print">üñ®Ô∏è Print Certificate</button>
    </div>

    <!-- Hidden PDF template rendered off-screen by html2canvas -->
    <div id="pdfTemplate" style="position:fixed; left:-9999px; top:0; width:1122px; height:793px;">
        <div style="width:1122px; height:793px; background:white; position:relative; overflow:hidden; font-family:'Montserrat',sans-serif;">
            <div style="position:absolute; top:-50px; left:-50px; width:250px; height:250px; background:radial-gradient(circle, rgba(102,126,234,0.2) 0%, transparent 70%); border-radius:0 0 100% 0;"></div>
            <div style="position:absolute; bottom:-50px; right:-50px; width:250px; height:250px; background:radial-gradient(circle, rgba(249,168,37,0.2) 0%, transparent 70%); border-radius:100% 0 0 0;"></div>
            <div style="position:absolute; top:30px; left:30px; right:30px; bottom:30px; border:8px solid transparent; border-image:linear-gradient(135deg, #667eea 0%, #f9a825 50%, #667eea 100%) 1;"></div>
            <div style="position:absolute; top:45px; left:45px; right:45px; bottom:45px; border:2px solid #e0e0e0;"></div>
            <div style="position:relative; z-index:10; padding:60px 60px 50px; text-align:center;">
                <div style="width:100px; height:100px; margin:0 auto 15px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:48px; box-shadow:0 5px 20px rgba(102,126,234,0.3);">üéì</div>
                <div style="font-family:'Playfair Display',serif; font-size:52px; font-weight:900; color:#667eea; margin-bottom:8px; letter-spacing:2px;">CERTIFICATE</div>
                <div style="font-family:'Playfair Display',serif; font-size:26px; font-weight:400; color:#f9a825; margin-bottom:25px; letter-spacing:8px;">OF COMPLETION</div>
                <div style="font-size:15px; color:#666; margin-bottom:20px; font-weight:500;">This Certificate Is Proudly Presented To</div>
                <div style="font-family:'Playfair Display',serif; font-size:44px; font-weight:700; color:#333; margin-bottom:8px; border-bottom:3px solid #667eea; display:inline-block; padding:0 30px 8px;">{{ full_name }}</div>
                <div style="font-size:14px; color:#555; line-height:1.7; margin:25px auto; max-width:700px;">
                    This certifies that the above-named individual has successfully completed the
                    <strong>PhishGuard Cybersecurity Awareness Training Program</strong>, demonstrating
                    proficiency in identifying and preventing phishing attacks across email, SMS, and
                    social media platforms.
                </div>
                <div style="display:inline-block; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; padding:10px 28px; border-radius:25px; font-weight:700; font-size:17px; margin:15px 0;">Score: {{ score }}%</div>
                <div style="margin-top:25px; display:flex; justify-content:space-between; align-items:center; padding:0 60px;">
                    <div style="text-align:center; flex:1;">
                        <div style="width:200px; height:2px; background:#333; margin:0 auto 10px;"></div>
                        <div style="font-weight:700; color:#333; font-size:16px; margin-bottom:8px;">O. N. Muminov</div>
                        <div style="font-size:13px; color:#666; text-transform:uppercase; letter-spacing:1px;">Principal Director</div>
                    </div>
                    <div style="text-align:center; flex:1;">
                        <div style="font-weight:700; color:#333; font-size:16px; margin-bottom:8px;">{{ date }}</div>
                        <div style="font-size:13px; color:#666; text-transform:uppercase; letter-spacing:1px;">Date of Completion</div>
                    </div>
                    <div style="text-align:center; flex:1;">
                        <div style="width:200px; height:2px; background:#333; margin:0 auto 10px;"></div>
                        <div style="font-weight:700; color:#333; font-size:16px; margin-bottom:8px;">PhishGuard Team</div>
                        <div style="font-size:13px; color:#666; text-transform:uppercase; letter-spacing:1px;">Certification Authority</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const translations = {
            en: {
                'cert-title': 'Certificate',
                'cert-subtitle': 'of Completion',
                'cert-text-intro': 'This is to certify that',
                'cert-achievement-line1': 'Has successfully completed the',
                'cert-program-name': 'PhishGuard Phishing Awareness Training Program',
                'cert-achievement-line2': 'and demonstrated proficiency in identifying and preventing phishing attacks',
                'cert-score-label': 'Final Exam Score:',
                'cert-sig-title': 'Program Director',
                'cert-sig-org': 'PhishGuard.uz',
                'cert-sig-date-label': 'Date of Completion',
                'btn-back': '‚Üê Back to Home',
                'btn-download': 'üìÑ Download Certificate',
                'btn-print': 'üñ®Ô∏è Print Certificate'
            },
            uz: {
                'cert-title': 'Sertifikat',
                'cert-subtitle': 'Bajarilish haqqida',
                'cert-text-intro': 'Bu sertifikat bilan tasdiqlanadi:',
                'cert-achievement-line1': 'Muvaffaqiyatli bajarilgan',
                'cert-program-name': 'PhishGuard Fishing Xabardorligi Dasturi',
                'cert-achievement-line2': 'va fishing hujumlarini aniqlash va oldini olishda o\'z salahiyatini ko\'rsatgan',
                'cert-score-label': 'Yakuniy imtihon bali:',
                'cert-sig-title': 'Dastur Direktori',
                'cert-sig-org': 'PhishGuard.uz',
                'cert-sig-date-label': 'Bajarilish sanasi',
                'btn-back': '‚Üê Bosh sahifaga qaytish',
                'btn-download': 'üìÑ Sertifikat yuklab oling',
                'btn-print': 'üñ®Ô∏è Sertifikat chiqarish'
            }
        };

        const currentLang = '{{ lang }}' || 'en';

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.dataset.translate;
                if (translations[currentLang] && translations[currentLang][key]) {
                    el.textContent = translations[currentLang][key];
                }
            });
        });

        async function downloadCertificate() {
            const template = document.getElementById('pdfTemplate');
            try {
                const canvas = await html2canvas(template, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff'
                });
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'landscape',
                    unit: 'px',
                    format: [canvas.width / 2, canvas.height / 2]
                });
                pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, canvas.width / 2, canvas.height / 2);
                pdf.save('PhishGuard_Certificate.pdf');
            } catch (err) {
                console.error('Certificate PDF error:', err);
                alert(currentLang === 'uz'
                    ? 'PDF yaratishda xato. Iltimos, chiqarish (Print) sevarasini sinab ko\'ring.'
                    : 'Could not generate PDF. Please try the Print option instead.');
            }
        }
    </script>
</body>
</html>
